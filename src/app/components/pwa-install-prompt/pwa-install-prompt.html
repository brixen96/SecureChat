<!-- Install Prompt -->
@if (showPrompt() && !showInstructions()) {
	<div class="pwa-prompt-overlay" (click)="onDismiss()">
		<div class="pwa-prompt-card" (click)="$event.stopPropagation()">
			<div class="pwa-prompt-icon">
				<svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path
						d="M12 2L2 7V12C2 16.97 5.5 21.47 10 22.5V20.45C6.55 19.5 4 16.42 4 12V8.3L12 4.19L20 8.3V12C20 16.42 17.45 19.5 14 20.45V22.5C18.5 21.47 22 16.97 22 12V7L12 2Z"
						fill="currentColor"
					/>
					<path d="M12 6L6 9V14C6 17.31 8.69 20.16 12 20.87C15.31 20.16 18 17.31 18 14V9L12 6Z" fill="currentColor" opacity="0.5" />
				</svg>
			</div>

			<h3 class="pwa-prompt-title">Install SecureChat</h3>
			<p class="pwa-prompt-description">Install SecureChat on your device for quick access, offline support, and push notifications!</p>

			<div class="pwa-prompt-features">
				<div class="feature">
					<i class="bi bi-lightning-fill"></i>
					<span>Instant access</span>
				</div>
				<div class="feature">
					<i class="bi bi-wifi-off"></i>
					<span>Works offline</span>
				</div>
				<div class="feature">
					<i class="bi bi-bell-fill"></i>
					<span>Push notifications</span>
				</div>
			</div>

			<div class="pwa-prompt-actions">
				<button class="btn btn-secondary" (click)="onDismiss()">Maybe Later</button>
				<button class="btn btn-primary" (click)="onInstall()" [disabled]="installing()">
					@if (installing()) {
						<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
						Installing...
					} @else {
						<i class="bi bi-download me-2"></i>
						Install Now
					}
				</button>
			</div>

			<button class="pwa-prompt-help" (click)="showManualInstructions()">
				<i class="bi bi-question-circle"></i>
				Need help installing?
			</button>
		</div>
	</div>
}

<!-- Manual Instructions -->
@if (showInstructions() && instructions) {
	<div class="pwa-prompt-overlay" (click)="closeInstructions()">
		<div class="pwa-instructions-card" (click)="$event.stopPropagation()">
			<button class="close-btn" (click)="closeInstructions()">
				<i class="bi bi-x-lg"></i>
			</button>

			<div class="instructions-icon">
				<i class="bi bi-phone"></i>
			</div>

			<h3 class="instructions-title">Install SecureChat</h3>
			<p class="instructions-platform">{{ instructions.platform }}</p>

			<ol class="instructions-list">
				@for (step of instructions.instructions; track $index) {
					<li>{{ step }}</li>
				}
			</ol>

			<div class="instructions-visual">
				@if (instructions.platform === 'iOS/Safari') {
					<div class="ios-visual">
						<div class="share-icon">
							<i class="bi bi-box-arrow-up"></i>
						</div>
						<div class="arrow-down">
							<i class="bi bi-arrow-down"></i>
						</div>
						<div class="add-to-home">Add to Home Screen</div>
					</div>
				} @else {
					<div class="android-visual">
						<div class="menu-icon">
							<i class="bi bi-three-dots-vertical"></i>
						</div>
						<div class="arrow-down">
							<i class="bi bi-arrow-down"></i>
						</div>
						<div class="install-text">Install app</div>
					</div>
				}
			</div>

			<button class="btn btn-primary w-100 mt-3" (click)="closeInstructions()">Got it!</button>
		</div>
	</div>
}
