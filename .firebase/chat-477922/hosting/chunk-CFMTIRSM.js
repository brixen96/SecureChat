import{$a as Ve,Aa as Fe,Ca as V,D as I,Da as Z,E as s,Fa as U,G as f,Ga as k,H as w,Ha as y,I as Me,Ia as F,J as O,Ja as D,Ka as Te,La as j,M as b,Ma as Ie,N as C,Na as L,Oa as B,P as q,Pa as Ae,Q,Qa as R,R as u,Ra as Ee,S as r,Sa as T,T as o,Ta as ee,U as m,Ua as z,Xa as te,Y as M,Ya as Ne,Za as ne,_ as p,_a as H,a as fe,aa as d,ab as De,b as _e,ba as me,ca as le,da as pe,ea as Y,f as he,fa as c,ga as S,ha as v,i as de,ia as Pe,ja as ye,ka as Oe,la as we,m as be,ma as K,n as Ce,na as W,o as xe,qa as Se,r as N,ra as Ue,s as ve,sa as J,ta as X,u as G,ua as P,wa as ke,x as _,y as h}from"./chunk-XBU3X5FZ.js";var $=class n{constructor(t){this.http=t}apiUrl=Ne.apiurl;getUsers(){return this.http.get(`${this.apiUrl}users/`,{headers:{"Cache-Control":"no-cache"}})}createUser(t){return this.http.post(`${this.apiUrl}admin/users`,{username:t})}getServerTime(){return this.http.get(`${this.apiUrl}users/time`)}getNotes(t){return this.http.get(`${this.apiUrl}admin/users/${t}/notes`)}addNote(t,e){return this.http.post(`${this.apiUrl}admin/users/${t}/notes`,{content:e})}static \u0275fac=function(e){return new(e||n)(G(ke))};static \u0275prov=N({token:n,factory:n.\u0275fac,providedIn:"root"})};var ie=class n{constructor(){}setAppBadge(t){"setAppBadge"in navigator&&navigator.setAppBadge(t)}clearAppBadge(){"clearAppBadge"in navigator&&navigator.clearAppBadge()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=N({token:n,factory:n.\u0275fac,providedIn:"root"})};var re=class n{constructor(t,e){this.chatService=t;this.badgeService=e}unreadCountSubject=new he(0);unreadCount$=this.unreadCountSubject.asObservable();updateUnreadCount(){return this.chatService.getUnreadCount().pipe(xe(t=>{this.unreadCountSubject.next(t),t>0?this.badgeService.setAppBadge(t):this.badgeService.clearAppBadge()}))}static \u0275fac=function(e){return new(e||n)(G(H),G(ie))};static \u0275prov=N({token:n,factory:n.\u0275fac,providedIn:"root"})};function We(n,t){if(n&1&&(r(0,"span",15),c(1),o()),n&2){let e=d().$implicit;s(),v(" ",e.unread_count," ")}}function Je(n,t){if(n&1&&(r(0,"span",16),c(1),o()),n&2){let e=d().$implicit,i=d();s(),v(" ",i.timeSince(e.last_message_timestamp)," ")}}function Xe(n,t){n&1&&(r(0,"span",26),c(1,"Cleared!"),o())}function Ze(n,t){n&1&&(r(0,"span",27),c(1,"Error!"),o())}function et(n,t){n&1&&(r(0,"span"),c(1,"Clear History"),o())}function tt(n,t){n&1&&(r(0,"span"),c(1,"Clearing..."),o())}function nt(n,t){if(n&1&&(r(0,"div",28)(1,"div",29)(2,"p",30),c(3),o(),r(4,"small",31),c(5),K(6,"date"),o()()()),n&2){let e=t.$implicit;s(3),S(e.content),s(2),Pe("By ",e.admin_username," on ",W(6,3,e.timestamp,"medium"))}}function it(n,t){if(n&1){let e=M();r(0,"div",17),m(1,"hr"),r(2,"h5"),c(3,"User Controls"),o(),r(4,"div",1)(5,"div"),O(6,Xe,2,0,"span",18)(7,Ze,2,0,"span",19),r(8,"button",20),p("click",function(a){_(e);let l=d().$implicit;return d().onClearUserChatHistory(l.username),h(a.stopPropagation())}),O(9,et,2,0,"span",21)(10,tt,2,0,"span",21),o()()(),r(11,"div",17)(12,"h5"),c(13,"Notes"),o(),O(14,nt,7,6,"div",22),r(15,"div",23)(16,"textarea",24),we("ngModelChange",function(a){_(e);let l=d().$implicit;return Oe(l.newNote,a)||(l.newNote=a),h(a)}),p("click",function(a){return _(e),h(a.stopPropagation())}),o(),r(17,"button",25),p("click",function(a){_(e);let l=d().$implicit;return d().addNote(l),h(a.stopPropagation())}),c(18,"Add Note"),o()()()()}if(n&2){let e=d().$implicit,i=d();s(6),u("ngIf",i.clearingHistoryFor===e.username&&i.clearHistorySuccess),s(),u("ngIf",i.clearingHistoryFor===e.username&&i.clearHistoryError),s(),u("disabled",i.clearingHistoryFor===e.username),s(),u("ngIf",i.clearingHistoryFor!==e.username),s(),u("ngIf",i.clearingHistoryFor===e.username),s(4),u("ngForOf",e.notes),s(2),ye("ngModel",e.newNote)}}function rt(n,t){if(n&1){let e=M();r(0,"li",8),p("click",function(){let a=_(e).$implicit,l=d();return h(l.toggleExpand(a))}),r(1,"div",1)(2,"span",9),c(3),O(4,We,2,1,"span",10)(5,Je,2,1,"span",11),o(),r(6,"div")(7,"button",12),p("click",function(a){let l=_(e).$implicit;return d().selectUser(l),h(a.stopPropagation())}),m(8,"i",13),o()()(),O(9,it,19,7,"div",14),o()}if(n&2){let e=t.$implicit;s(3),v(" ",e.username," "),s(),u("ngIf",e.unread_count&&e.unread_count>0),s(),u("ngIf",e.last_message_timestamp),s(4),u("ngIf",e.expanded)}}var oe=class n{constructor(t,e,i,a,l,g){this.userService=t;this.authService=e;this.router=i;this.chatService=a;this.unreadMessageService=l;this.cd=g}users=[];clearHistorySuccess=!1;clearHistoryError=null;clearingHistoryFor=null;messageSubscription;unreadCountSubscription;timerSubscription;ngOnInit(){this.loadUsers(),this.chatService.connect(),this.messageSubscription=this.chatService.getMessages().subscribe(t=>{this.loadUsers(),this.unreadMessageService.updateUnreadCount()}),this.unreadCountSubscription=de(1e4).pipe(be(0),Ce(()=>this.unreadMessageService.updateUnreadCount())).subscribe(),this.timerSubscription=de(6e4).subscribe(()=>{this.cd.markForCheck()})}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.unreadCountSubscription&&this.unreadCountSubscription.unsubscribe(),this.timerSubscription&&this.timerSubscription.unsubscribe()}loadUsers(){this.userService.getUsers().subscribe(t=>{this.users=t.map(e=>_e(fe({},e),{expanded:!1,notes:[],newNote:""})).sort((e,i)=>e.last_message_timestamp&&i.last_message_timestamp?new Date(i.last_message_timestamp).getTime()-new Date(e.last_message_timestamp).getTime():e.last_message_timestamp?-1:i.last_message_timestamp?1:0)})}toggleExpand(t){t.expanded=!t.expanded,t.expanded&&this.getNotes(t)}getNotes(t){this.userService.getNotes(t.username).subscribe(e=>{t.notes=e})}addNote(t){t.newNote&&this.userService.addNote(t.username,t.newNote).subscribe(()=>{this.getNotes(t),t.newNote=""})}selectUser(t){this.router.navigate(["/admin/chat",t.username])}navigateToCreateUser(){this.router.navigate(["/admin/users/new"])}onClearUserChatHistory(t){confirm(`Are you sure you want to clear the chat history for ${t}? This action cannot be undone.`)&&(this.clearingHistoryFor=t,this.clearHistoryError=null,this.clearHistorySuccess=!1,this.chatService.clearUserChatHistory(t).subscribe({next:()=>{this.clearHistorySuccess=!0,setTimeout(()=>{this.clearHistorySuccess=!1,this.clearingHistoryFor=null},3e3)},error:e=>{this.clearHistoryError=`Failed to clear chat history for ${t}: ${e.error.detail||"Unknown error"}`,setTimeout(()=>{this.clearHistoryError=null,this.clearingHistoryFor=null},5e3)}}))}logout(){this.authService.logout(),this.router.navigate(["/login"])}timeSince(t){let e=t.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);if(!e)return t;let i=parseInt(e[1],10),a=parseInt(e[2],10)-1,l=parseInt(e[3],10),g=parseInt(e[4],10),$e=parseInt(e[5],10),Ge=parseInt(e[6],10),Ye=new Date(Date.UTC(i,a,l,g,$e,Ge)),E=Math.floor((new Date().getTime()-Ye.getTime())/1e3),x=E/31536e3;return x>1?Math.floor(x)+" years ago":(x=E/2592e3,x>1?Math.floor(x)+" months ago":(x=E/86400,x>1?Math.floor(x)+" days ago":(x=E/3600,x>1?Math.floor(x)+" hours ago":(x=E/60,x>1?Math.floor(x)+" minutes ago":Math.floor(E)+" seconds ago"))))}static \u0275fac=function(e){return new(e||n)(f($),f(ne),f(V),f(H),f(re),f(Se))};static \u0275cmp=w({type:n,selectors:[["app-user-list"]],decls:13,vars:1,consts:[[1,"container"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-primary","me-2",3,"click"],["routerLink","/admin/menu",1,"btn","btn-outline-primary","me-2"],[1,"bi","bi-card-list"],[1,"btn","btn-danger",3,"click"],[1,"list-group"],["class","list-group-item py-3","style","cursor: pointer",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item","py-3",2,"cursor","pointer",3,"click"],[1,"flex-grow-1"],["class","badge bg-primary rounded-pill ms-2",4,"ngIf"],["class","text-muted ms-2","style","font-size: 0.8em",4,"ngIf"],[1,"btn","btn-primary","btn-lg","btn-sm","me-2",3,"click"],[1,"bi","bi-chat-dots"],["class","mt-3",4,"ngIf"],[1,"badge","bg-primary","rounded-pill","ms-2"],[1,"text-muted","ms-2",2,"font-size","0.8em"],[1,"mt-3"],["class","text-success me-2",4,"ngIf"],["class","text-danger me-2",4,"ngIf"],[1,"btn","btn-danger","btn-sm",3,"click","disabled"],[4,"ngIf"],["class","card mb-2",4,"ngFor","ngForOf"],[1,"mt-2"],["rows","3",1,"form-control",3,"ngModelChange","click","ngModel"],[1,"btn","btn-success","btn-sm","mt-2",3,"click"],[1,"text-success","me-2"],[1,"text-danger","me-2"],[1,"card","mb-2"],[1,"card-body"],[1,"card-text"],[1,"text-muted"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"button",2),p("click",function(){return i.navigateToCreateUser()}),c(4,"New User"),o(),r(5,"a",3),m(6,"i",4),c(7," Menu "),o(),r(8,"button",5),p("click",function(){return i.logout()}),c(9,"Logout"),o()()(),m(10,"hr"),r(11,"ul",6),O(12,rt,10,4,"li",7),o()()),e&2&&(s(12),u("ngForOf",i.users))},dependencies:[P,Ue,J,U,Z,Ee,k,F,Te,X],styles:[".container[_ngcontent-%COMP%]{padding:1rem;max-width:100%}@media (min-width: 768px){.container[_ngcontent-%COMP%]{padding:2rem}}h2[_ngcontent-%COMP%]{color:#fff;font-size:1.5rem;margin:0}@media (max-width: 576px){h2[_ngcontent-%COMP%]{font-size:1.25rem}}@media (max-width: 576px){.d-flex[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start!important;gap:.75rem}.d-flex.justify-content-between[_ngcontent-%COMP%]{width:100%}.d-flex.justify-content-between[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;gap:.5rem;width:100%}.d-flex.justify-content-between[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}}hr[_ngcontent-%COMP%]{border-color:#3d3d3d;margin:1rem 0}.list-group[_ngcontent-%COMP%]{gap:.75rem}.list-group-item[_ngcontent-%COMP%]{background-color:#2d2d2d;border:1px solid #3d3d3d;border-radius:12px;color:#fff;transition:all .2s ease;cursor:pointer}.list-group-item[_ngcontent-%COMP%]:hover{background-color:#353535;border-color:#4d4d4d;transform:translateY(-2px);box-shadow:0 4px 12px #0000004d}.list-group-item[_ngcontent-%COMP%]:active{transform:translateY(0)}.badge[_ngcontent-%COMP%]{font-size:.85rem;padding:.35rem .65rem;border-radius:12px;font-weight:600}.badge.bg-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc3545,#c82333)!important;box-shadow:0 2px 6px #dc354566;animation:_ngcontent-%COMP%_badgePulse 2s infinite}@keyframes _ngcontent-%COMP%_badgePulse{0%,to{box-shadow:0 2px 6px #dc354566}50%{box-shadow:0 2px 12px #dc354599}}.text-muted[_ngcontent-%COMP%]{color:#888!important;font-size:.8rem}@media (max-width: 576px){.text-muted[_ngcontent-%COMP%]{display:block;margin-top:.25rem}}.btn[_ngcontent-%COMP%]{transition:all .2s ease;font-weight:600}.btn.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0084ff,#06c);border:none;box-shadow:0 2px 6px #0084ff4d}.btn.btn-primary[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#06c,#0052a3);box-shadow:0 4px 12px #0084ff66;transform:translateY(-1px)}.btn.btn-primary[_ngcontent-%COMP%]:active{transform:translateY(0)}.btn.btn-danger[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc3545,#c82333);border:none;box-shadow:0 2px 6px #dc35454d}.btn.btn-danger[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#c82333,#bd2130);box-shadow:0 4px 12px #dc354566;transform:translateY(-1px)}.btn.btn-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);border:none;box-shadow:0 2px 6px #28a7454d}.btn.btn-success[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#218838,#1e7e34);box-shadow:0 4px 12px #28a74566;transform:translateY(-1px)}.btn.btn-sm[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.875rem}@media (max-width: 576px){.btn.btn-lg[_ngcontent-%COMP%]{padding:.5rem .75rem}}.btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}.card[_ngcontent-%COMP%]{background-color:#1a1a1a;border:1px solid #3d3d3d;border-radius:8px;margin-bottom:.75rem}.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1rem}.card[_ngcontent-%COMP%]   .card-text[_ngcontent-%COMP%]{color:#fff;margin-bottom:.5rem}.card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#888}.form-control[_ngcontent-%COMP%]{background-color:#1a1a1a;border:1px solid #3d3d3d;color:#fff;border-radius:8px}.form-control[_ngcontent-%COMP%]:focus{background-color:#1a1a1a;border-color:#0084ff;color:#fff;box-shadow:0 0 0 .2rem #0084ff40}.form-control[_ngcontent-%COMP%]::placeholder{color:#666}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.text-success[_ngcontent-%COMP%]{color:#28a745!important;font-weight:600}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important;font-weight:600}h5[_ngcontent-%COMP%]{color:#fff;font-size:1.1rem;margin-top:1rem;margin-bottom:.75rem}@media (max-width: 576px){.container[_ngcontent-%COMP%]{padding:.75rem}.list-group-item[_ngcontent-%COMP%]{padding:1rem!important}.list-group-item[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{flex-wrap:wrap}.list-group-item[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{flex-basis:100%;margin-bottom:.5rem}.list-group-item[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex-basis:100%}.btn-group[_ngcontent-%COMP%]{display:flex;width:100%;gap:.5rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1}}"]})};var at=["messageList"],st=["messageInput"],ct=(n,t)=>t.timestamp;function dt(n,t){if(n&1&&(r(0,"h2"),c(1),o()),n&2){let e=d();s(),S(e.selectedUsername)}}function mt(n,t){if(n&1&&(r(0,"div",16)(1,"div",17)(2,"p",18),c(3),o(),r(4,"span",19),c(5),K(6,"date"),o()()()),n&2){let e=t.$implicit,i=d();Y("sent",e.sender===i.currentUsername)("received",e.sender!==i.currentUsername),s(3),S(e.text),s(2),S(W(6,6,e.timestamp,"shortTime"))}}function lt(n,t){if(n&1&&(r(0,"div",10),c(1),r(2,"span",20),m(3,"span")(4,"span")(5,"span"),o()()),n&2){let e=d();s(),v(" ",e.selectedUsername," is typing ")}}function pt(n,t){n&1&&m(0,"span",15)}function ut(n,t){n&1&&c(0," Send ")}var ae=class n{constructor(t,e,i,a,l,g){this.authService=t;this.router=e;this.route=i;this.chatService=a;this.fb=l;this.notificationService=g;this.messageForm=this.fb.group({message:["",y.required]})}messageListContainer;messageInput;messages=[];messageForm;messageSubscription;typingSubscription;currentUsername=null;selectedUsername=null;faArrowLeft=te;isTyping=!1;isSending=!1;typingTimeout;ngOnInit(){this.notificationService.requestPermission(),this.currentUsername=this.authService.getUsername(),this.route.paramMap.subscribe(t=>{this.selectedUsername=t.get("username"),this.selectedUsername&&(this.messages=[],this.chatService.getChatHistory(this.selectedUsername).subscribe(e=>{this.messages=e,this.scrollToBottom()}))}),this.chatService.connect(),this.messageSubscription=this.chatService.getMessages().subscribe(t=>{(t.sender===this.selectedUsername||t.sender===this.currentUsername&&t.recipient===this.selectedUsername)&&(this.messages.push(t),this.scrollToBottom(),t.sender!==this.currentUsername&&(document.hidden,this.notificationService.showNotification("New Message",{body:t.text,icon:"assets/icons/icon-192x192.png"})))}),this.typingSubscription=this.chatService.getTypingIndicator().subscribe(t=>{this.isTyping=t,t&&this.scrollToBottom()})}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){try{this.messageListContainer.nativeElement.scrollTop=this.messageListContainer.nativeElement.scrollHeight}catch{}}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.typingSubscription&&this.typingSubscription.unsubscribe(),this.typingTimeout&&clearTimeout(this.typingTimeout),this.chatService.disconnect()}onTyping(){this.typingTimeout&&clearTimeout(this.typingTimeout),this.selectedUsername&&this.chatService.sendTypingIndicator(!0,this.selectedUsername),this.typingTimeout=setTimeout(()=>{this.selectedUsername&&this.chatService.sendTypingIndicator(!1,this.selectedUsername)},1e3)}sendMessage(){if(this.messageForm.valid&&this.selectedUsername&&!this.isSending){this.isSending=!0;let e={text:this.messageForm.value.message,recipient:this.selectedUsername};this.typingTimeout&&clearTimeout(this.typingTimeout),this.chatService.sendTypingIndicator(!1,this.selectedUsername),this.chatService.sendMessage(e),this.messageForm.reset(),setTimeout(()=>{this.isSending=!1,this.scrollToBottom()},300)}}goBack(){this.router.navigate(["/admin/users"])}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||n)(f(ne),f(V),f(Fe),f(H),f(R),f(Ve))};static \u0275cmp=w({type:n,selectors:[["app-admin-chat"]],viewQuery:function(e,i){if(e&1&&(me(at,5),me(st,5)),e&2){let a;le(a=pe())&&(i.messageListContainer=a.first),le(a=pe())&&(i.messageInput=a.first)}},decls:20,vars:6,consts:[["messageList",""],["messageInput",""],[1,"page-container"],[1,"header"],[1,"btn","btn-secondary",3,"click"],[3,"icon"],[1,"btn","btn-danger",3,"click"],[1,"chat-container"],[1,"message-list"],[1,"message",3,"sent","received"],[1,"typing-indicator"],[1,"message-form",3,"ngSubmit","formGroup"],[1,"input-group"],["type","text","formControlName","message","placeholder","Type your message...",1,"form-control",3,"input"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"message"],[1,"message-bubble"],[1,"message-text"],[1,"message-timestamp"],[1,"dots"]],template:function(e,i){if(e&1){let a=M();r(0,"div",2)(1,"div",3)(2,"button",4),p("click",function(){return _(a),h(i.goBack())}),m(3,"fa-icon",5),o(),b(4,dt,2,1,"h2"),r(5,"button",6),p("click",function(){return _(a),h(i.logout())}),c(6,"Logout"),o()(),r(7,"div",7)(8,"div",8,0),q(10,mt,7,9,"div",9,ct),b(12,lt,6,1,"div",10),o(),r(13,"form",11),p("ngSubmit",function(){return _(a),h(i.sendMessage())}),r(14,"div",12)(15,"input",13,1),p("input",function(){return _(a),h(i.onTyping())}),o(),r(17,"button",14),b(18,pt,1,0,"span",15)(19,ut,1,0),o()()()()()}e&2&&(s(3),u("icon",i.faArrowLeft),s(),C(i.selectedUsername?4:-1),s(6),Q(i.messages),s(2),C(i.isTyping?12:-1),s(),u("formGroup",i.messageForm),s(4),u("disabled",i.messageForm.invalid||i.isSending),s(),C(i.isSending?18:19))},dependencies:[P,U,T,j,k,F,D,L,B,z,ee,X],styles:[".page-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;padding:0;background-color:#1a1a1a}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-shrink:0;padding:1rem;background-color:#2d2d2d;box-shadow:0 2px 4px #0000004d;position:sticky;top:0;z-index:100}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;margin:0;color:#fff;flex-grow:1;text-align:center}@media (max-width: 576px){.header[_ngcontent-%COMP%]{padding:.75rem .5rem}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.1rem}.header[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.375rem .5rem;font-size:.875rem}.header[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]{padding:.375rem .75rem}}.chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}.message-list[_ngcontent-%COMP%]{flex-grow:1;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding:1rem;background-color:#1a1a1a;scroll-behavior:smooth}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#444;border-radius:3px}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.message[_ngcontent-%COMP%]{display:flex;width:100%;animation:_ngcontent-%COMP%_messageSlideIn .2s ease-out}@keyframes _ngcontent-%COMP%_messageSlideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.message-bubble[_ngcontent-%COMP%]{padding:12px 16px;border-radius:18px;max-width:85%;display:flex;flex-direction:column;word-wrap:break-word;position:relative}@media (min-width: 768px){.message-bubble[_ngcontent-%COMP%]{max-width:70%}}.message.sent[_ngcontent-%COMP%]{justify-content:flex-end}.message.sent[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0084ff,#06c);color:#fff;border-bottom-right-radius:4px;box-shadow:0 2px 8px #0084ff4d}.message.received[_ngcontent-%COMP%]{justify-content:flex-start}.message.received[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:#2d2d2d;color:#fff;border-bottom-left-radius:4px;box-shadow:0 2px 8px #0000004d}.message-text[_ngcontent-%COMP%]{margin:0;overflow-wrap:break-word;word-break:break-word;line-height:1.4;font-size:.95rem}.message-timestamp[_ngcontent-%COMP%]{font-size:.7rem;margin-top:4px;align-self:flex-end;opacity:.8}.message.sent[_ngcontent-%COMP%]   .message-timestamp[_ngcontent-%COMP%]{color:#fffc}.message.received[_ngcontent-%COMP%]   .message-timestamp[_ngcontent-%COMP%]{color:#fff9}.message-form[_ngcontent-%COMP%]{padding:1rem;background-color:#2d2d2d;border-top:1px solid #3d3d3d;position:sticky;bottom:0}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{gap:.5rem}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background-color:#1a1a1a;border:1px solid #3d3d3d;color:#fff;border-radius:24px;padding:.75rem 1rem;font-size:.95rem}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{background-color:#1a1a1a;border-color:#0084ff;color:#fff;box-shadow:0 0 0 .2rem #0084ff40}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:#888}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:24px;padding:.75rem 1.5rem;font-weight:600;min-width:80px}@media (max-width: 576px){.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.75rem 1rem;min-width:70px}}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.5}.typing-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.5rem 1rem;color:#888;font-size:.85rem;font-style:italic}.typing-indicator[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]{display:inline-flex;gap:4px;margin-left:4px}.typing-indicator[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:4px;height:4px;background-color:#888;border-radius:50%;animation:_ngcontent-%COMP%_typingDot 1.4s infinite ease-in-out}.typing-indicator[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){animation-delay:-.32s}.typing-indicator[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.16s}@keyframes _ngcontent-%COMP%_typingDot{0%,80%,to{transform:scale(0);opacity:.5}40%{transform:scale(1);opacity:1}}"]})};function gt(n,t){if(n&1&&(r(0,"div",11),c(1," User created successfully!"),m(2,"br"),c(3),m(4,"br"),c(5),o()),n&2){let e=d();s(3),v(" Username: ",e.newUser.username),s(2),v(" Password: ",e.newUser.password," ")}}function ft(n,t){if(n&1&&(r(0,"div",12),c(1),o()),n&2){let e=d();s(),v(" ",e.createUserError," ")}}var se=class n{constructor(t,e,i){this.userService=t;this.router=e;this.fb=i;this.createUserForm=this.fb.group({username:["",y.required]})}createUserForm;newUser=null;createUserError=null;faArrowLeft=te;onCreateUser(){if(this.createUserForm.valid){let t=this.createUserForm.value.username;this.userService.createUser(t).subscribe({next:e=>{this.newUser=e,this.createUserError=null,this.createUserForm.reset()},error:e=>{this.createUserError=e.error.detail||"Failed to create user",this.newUser=null}})}}goBack(){this.router.navigate(["/admin/users"])}static \u0275fac=function(e){return new(e||n)(f($),f(V),f(R))};static \u0275cmp=w({type:n,selectors:[["app-create-user"]],decls:17,vars:5,consts:[[1,"container","mt-5"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-secondary",3,"click"],[3,"icon"],[1,"mt-4"],[3,"ngSubmit","formGroup"],[1,"input-group","mb-3"],["type","text","placeholder","Username","formControlName","username",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-success"],[1,"alert","alert-danger"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),p("click",function(){return i.goBack()}),m(3,"fa-icon",3),c(4," Back to Users"),o(),r(5,"h2"),c(6,"Create New User"),o(),m(7,"div"),o(),m(8,"hr"),r(9,"div",4)(10,"form",5),p("ngSubmit",function(){return i.onCreateUser()}),r(11,"div",6),m(12,"input",7),r(13,"button",8),c(14,"Create"),o()()(),O(15,gt,6,2,"div",9)(16,ft,2,1,"div",10),o()()),e&2&&(s(3),u("icon",i.faArrowLeft),s(7),u("formGroup",i.createUserForm),s(3),u("disabled",i.createUserForm.invalid),s(2),u("ngIf",i.newUser),s(),u("ngIf",i.createUserError))},dependencies:[P,J,U,T,j,k,F,D,L,B,z,ee],encapsulation:2})};var _t=(n,t)=>t.id;function ht(n,t){if(n&1){let e=M();r(0,"div",10),m(1,"i",13),c(2),r(3,"button",14),p("click",function(){_(e);let a=d();return h(a.error.set(null))}),o()()}if(n&2){let e=d();s(2),v(" ",e.error()," ")}}function bt(n,t){n&1&&(m(0,"i",27),c(1," Edit Product "))}function Ct(n,t){n&1&&(m(0,"i",9),c(1," Add New Product "))}function xt(n,t){n&1&&(r(0,"div",21),c(1,"Product name is required"),o())}function vt(n,t){n&1&&(r(0,"div",21),c(1,"Price must be greater than 0"),o())}function Mt(n,t){n&1&&(m(0,"span",28),c(1," Saving... "))}function Pt(n,t){n&1&&c(0," Update Product ")}function yt(n,t){n&1&&c(0," Add Product ")}function Ot(n,t){if(n&1&&b(0,Pt,1,0)(1,yt,1,0),n&2){let e=d(2);C(e.editingProduct()?0:1)}}function wt(n,t){if(n&1){let e=M();r(0,"div",11)(1,"div",15)(2,"h3"),b(3,bt,2,0)(4,Ct,2,0),o(),r(5,"button",16),p("click",function(){_(e);let a=d();return h(a.hideForm())}),o()(),r(6,"form",17),p("ngSubmit",function(){_(e);let a=d();return h(a.saveProduct())}),r(7,"div",18)(8,"label",19),c(9,"Product Name"),o(),m(10,"input",20),b(11,xt,2,0,"div",21),o(),r(12,"div",18)(13,"label",22),c(14,"Price (DKK)"),o(),m(15,"input",23),b(16,vt,2,0,"div",21),o(),r(17,"div",24)(18,"button",25),p("click",function(){_(e);let a=d();return h(a.hideForm())}),c(19,"Cancel"),o(),r(20,"button",26),b(21,Mt,2,0)(22,Ot,2,1),o()()()()}if(n&2){let e,i,a,l,g=d();s(3),C(g.editingProduct()?3:4),s(3),u("formGroup",g.productForm),s(4),Y("is-invalid",((e=g.productForm.get("name"))==null?null:e.invalid)&&((e=g.productForm.get("name"))==null?null:e.touched)),s(),C((i=g.productForm.get("name"))!=null&&i.invalid&&((i=g.productForm.get("name"))!=null&&i.touched)?11:-1),s(4),Y("is-invalid",((a=g.productForm.get("price"))==null?null:a.invalid)&&((a=g.productForm.get("price"))==null?null:a.touched)),s(),C((l=g.productForm.get("price"))!=null&&l.invalid&&((l=g.productForm.get("price"))!=null&&l.touched)?16:-1),s(4),u("disabled",g.productForm.invalid||g.saving()),s(),C(g.saving()?21:22)}}function St(n,t){n&1&&(r(0,"div",12)(1,"div",29)(2,"span",30),c(3,"Loading..."),o()(),r(4,"p",31),c(5,"Loading products..."),o()())}function Ut(n,t){if(n&1){let e=M();r(0,"div",32),m(1,"i",34),r(2,"p"),c(3,"No products yet"),o(),r(4,"button",8),p("click",function(){_(e);let a=d(2);return h(a.showAddProductForm())}),m(5,"i",9),c(6," Add Your First Product "),o()()}}function kt(n,t){if(n&1){let e=M();r(0,"div",35)(1,"div",36),m(2,"i",37),o(),r(3,"div",38)(4,"h3",39),c(5),o(),r(6,"p",40),c(7),o()(),r(8,"div",41)(9,"button",42),p("click",function(){let a=_(e).$implicit,l=d(3);return h(l.editProduct(a))}),m(10,"i",43),o(),r(11,"button",44),p("click",function(){let a=_(e).$implicit,l=d(3);return h(l.deleteProduct(a))}),m(12,"i",45),o()()()}if(n&2){let e=t.$implicit,i=d(3);s(5),S(e.name),s(2),v("",i.formatPrice(e.price)," DKK")}}function Ft(n,t){if(n&1&&(r(0,"div",33),q(1,kt,13,2,"div",35,_t),o()),n&2){let e=d(2);s(),Q(e.products())}}function Tt(n,t){if(n&1&&b(0,Ut,7,0,"div",32)(1,Ft,3,0,"div",33),n&2){let e=d();C(e.products().length===0?0:1)}}var ce=class n{constructor(t,e){this.menuService=t;this.fb=e;this.productForm=this.fb.group({name:["",[y.required,y.minLength(1),y.maxLength(200)]],price:[0,[y.required,y.min(.01)]]})}products=I([]);loading=I(!0);error=I(null);showAddForm=I(!1);editingProduct=I(null);saving=I(!1);productForm;ngOnInit(){this.loadProducts()}loadProducts(){this.loading.set(!0),this.error.set(null),this.menuService.getAllProducts().subscribe({next:t=>{this.products.set(t),this.loading.set(!1)},error:t=>{console.error("Error loading menu:",t),this.error.set("Failed to load menu. Please try again later."),this.loading.set(!1)}})}showAddProductForm(){this.showAddForm.set(!0),this.editingProduct.set(null),this.productForm.reset({name:"",price:0})}hideForm(){this.showAddForm.set(!1),this.editingProduct.set(null),this.productForm.reset()}editProduct(t){this.editingProduct.set(t),this.showAddForm.set(!0),this.productForm.patchValue({name:t.name,price:t.price})}saveProduct(){if(this.productForm.invalid||this.saving())return;this.saving.set(!0);let t=this.productForm.value;if(this.editingProduct()){let e=this.editingProduct().id;this.menuService.updateProduct(e,t).subscribe({next:i=>{let a=this.products(),l=a.findIndex(g=>g.id===e);l!==-1&&(a[l]=i,this.products.set([...a])),this.hideForm(),this.saving.set(!1)},error:i=>{console.error("Error updating product:",i),this.error.set("Failed to update product. Please try again."),this.saving.set(!1)}})}else{let e={name:t.name,price:t.price};this.menuService.createProduct(e).subscribe({next:i=>{this.products.set([i,...this.products()]),this.hideForm(),this.saving.set(!1)},error:i=>{console.error("Error creating product:",i),this.error.set("Failed to create product. Please try again."),this.saving.set(!1)}})}}deleteProduct(t){t.id&&confirm(`Are you sure you want to delete "${t.name}"?`)&&this.menuService.deleteProduct(t.id).subscribe({next:()=>{this.products.set(this.products().filter(e=>e.id!==t.id))},error:e=>{console.error("Error deleting product:",e),this.error.set("Failed to delete product. Please try again.")}})}formatPrice(t){return t.toFixed(2)}static \u0275fac=function(e){return new(e||n)(f(De),f(R))};static \u0275cmp=w({type:n,selectors:[["app-admin-menu"]],decls:19,vars:4,consts:[[1,"menu-container"],[1,"menu-header"],[1,"menu-title"],[1,"bi","bi-card-list"],[1,"menu-subtitle"],[1,"header-actions"],["routerLink","/admin/users",1,"btn","btn-outline-primary","me-2"],[1,"bi","bi-arrow-left","me-2"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],["role","alert",1,"alert","alert-danger","alert-dismissible"],[1,"product-form-card"],[1,"loading-container"],[1,"bi","bi-exclamation-triangle","me-2"],["type","button",1,"btn-close",3,"click"],[1,"form-header"],[1,"btn-close",3,"click"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","productName",1,"form-label"],["type","text","id","productName","formControlName","name","placeholder","Enter product name",1,"form-control"],[1,"invalid-feedback"],["for","productPrice",1,"form-label"],["type","number","step","0.01","min","0.01","id","productPrice","formControlName","price","placeholder","0.00",1,"form-control"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"bi","bi-pencil","me-2"],[1,"spinner-border","spinner-border-sm","me-2"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"loading-text"],[1,"empty-state"],[1,"products-list"],[1,"bi","bi-inbox"],[1,"product-item"],[1,"product-icon"],[1,"bi","bi-bag-fill"],[1,"product-info"],[1,"product-name"],[1,"product-price"],[1,"product-actions"],["title","Edit product",1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"bi","bi-pencil"],["title","Delete product",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),m(4,"i",3),c(5," Menu Management "),o(),r(6,"p",4),c(7,"Manage your products"),o()(),r(8,"div",5)(9,"a",6),m(10,"i",7),c(11," Back to Users "),o(),r(12,"button",8),p("click",function(){return i.showAddProductForm()}),m(13,"i",9),c(14," Add Product "),o()()(),b(15,ht,4,1,"div",10),b(16,wt,23,10,"div",11),b(17,St,6,0,"div",12),b(18,Tt,2,1),o()),e&2&&(s(15),C(i.error()?15:-1),s(),C(i.showAddForm()?16:-1),s(),C(i.loading()?17:-1),s(),C(i.loading()?-1:18))},dependencies:[P,T,j,k,Ie,F,D,Ae,L,B,Z],styles:[".menu-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#1a1a1a;padding:1.5rem;max-width:1200px;margin:0 auto}@media (max-width: 576px){.menu-container[_ngcontent-%COMP%]{padding:1rem}}.menu-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}@media (max-width: 768px){.menu-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}@media (max-width: 576px){.header-actions[_ngcontent-%COMP%]{flex-direction:column}}.menu-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#fff;margin-bottom:.5rem;display:flex;align-items:center;gap:.75rem}.menu-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#0084ff}@media (max-width: 576px){.menu-title[_ngcontent-%COMP%]{font-size:1.5rem}}.menu-subtitle[_ngcontent-%COMP%]{color:#aaa;font-size:.95rem;margin:0}.product-form-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2d2d2d,#1a1a1a);border:1px solid #3d3d3d;border-radius:16px;padding:2rem;margin-bottom:2rem;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@media (max-width: 576px){.product-form-card[_ngcontent-%COMP%]{padding:1.5rem}}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.form-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.form-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#fff;margin:0;display:flex;align-items:center}.form-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#0084ff}.form-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{filter:invert(1)}.form-label[_ngcontent-%COMP%]{color:#ccc;font-weight:500;margin-bottom:.5rem}.form-control[_ngcontent-%COMP%]{background-color:#2d2d2d;border:1px solid #4d4d4d;color:#fff;padding:.75rem;border-radius:8px}.form-control[_ngcontent-%COMP%]:focus{background-color:#2d2d2d;border-color:#0084ff;box-shadow:0 0 0 .2rem #0084ff40;color:#fff}.form-control[_ngcontent-%COMP%]::placeholder{color:#777}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem}@media (max-width: 576px){.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 0;gap:1rem}.loading-text[_ngcontent-%COMP%]{color:#aaa;font-size:.95rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:#555;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#aaa;font-size:1.1rem;margin-bottom:1.5rem}.products-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.product-item[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2d2d2d,#1a1a1a);border:1px solid #3d3d3d;border-radius:12px;padding:1.25rem;display:flex;align-items:center;gap:1rem;transition:all .2s ease}.product-item[_ngcontent-%COMP%]:hover{border-color:#4d4d4d;box-shadow:0 4px 12px #0000004d}@media (max-width: 576px){.product-item[_ngcontent-%COMP%]{padding:1rem;flex-wrap:wrap}}.product-icon[_ngcontent-%COMP%]{width:56px;height:56px;background:linear-gradient(135deg,#0084ff,#06c);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.product-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.75rem;color:#fff}@media (max-width: 576px){.product-icon[_ngcontent-%COMP%]{width:48px;height:48px}.product-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}}.product-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center;min-width:0}@media (max-width: 576px){.product-info[_ngcontent-%COMP%]{width:100%;order:2}}.product-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#fff;margin:0 0 .25rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@media (max-width: 576px){.product-name[_ngcontent-%COMP%]{font-size:1rem;white-space:normal}}.product-price[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#0084ff;margin:0}@media (max-width: 576px){.product-price[_ngcontent-%COMP%]{font-size:1.1rem}}.product-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-shrink:0}@media (max-width: 576px){.product-actions[_ngcontent-%COMP%]{width:100%;order:3;margin-top:.75rem}}.product-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-width:40px;padding:.5rem}.product-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}@media (max-width: 576px){.product-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1}}"]})};var ze=[{path:"users/new",component:se},{path:"users",component:oe},{path:"chat/:username",component:ae},{path:"menu",component:ce},{path:"",redirectTo:"users",pathMatch:"full"}];var He=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Me({type:n});static \u0275inj=ve({imports:[P,U.forChild(ze),T,z]})};export{He as AdminModule};
