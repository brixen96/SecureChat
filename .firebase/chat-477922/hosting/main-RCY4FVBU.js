import{$ as S,$a as ge,A as Le,B as Ae,Ba as Je,C as Re,Ca as D,D as b,Da as pe,E as c,Ea as et,F as Ve,Fa as Y,G as g,Ga as H,H as x,Ha as I,Ia as K,J as T,Ja as $,K as je,L as Me,La as Q,M as v,N as _,Na as Z,O as ze,Oa as X,P as G,Q as W,Qa as J,R as f,S as a,Sa as ee,T as s,Ta as tt,U as p,Ua as nt,V as d,Va as it,W as m,Wa as ot,X as P,Y as oe,Ya as rt,Z as Ue,Za as E,_ as F,_a as at,a as ke,aa as u,ab as st,ba as Oe,c as de,ca as Se,d as le,da as ye,e as U,ea as Be,fa as r,g as R,ga as N,h as Pe,ha as z,j as k,k as xe,l as B,ma as qe,n as ie,na as Ge,oa as We,p as V,pa as Ye,q as Te,r as j,sa as me,t as Fe,ta as He,u as q,ua as y,v as O,va as Ke,w as Ne,wa as $e,x as w,xa as Qe,y as C,ya as Ze,z as De,za as Xe}from"./chunk-XBU3X5FZ.js";function vt(n,e){n&1&&(a(0,"div",4)(1,"div",18)(2,"div",19)(3,"span",20),r(4,"Logging in..."),s()(),a(5,"p",21),r(6,"Authenticating..."),s(),a(7,"div",22),p(8,"div",23),s()()())}function _t(n,e){if(n&1&&(a(0,"div",24),r(1),s()),n&2){let t=u();c(),z(" ",t.loginError," ")}}function wt(n,e){n&1&&(a(0,"div",25),r(1,"Username is required."),s())}function Ct(n,e){n&1&&(a(0,"div",25),r(1,"Password is required."),s())}function Pt(n,e){n&1&&(p(0,"span",26),r(1," Logging in... "))}function xt(n,e){n&1&&r(0," Login ")}var ue=class n{constructor(e,t,i){this.fb=e;this.authService=t;this.router=i;this.loginForm=this.fb.group({username:["",I.required],password:["",I.required]})}faUser=it;faLock=ot;loginForm;loginError=null;isLoading=b(!1);onSubmit(){this.loginError=null,this.loginForm.valid&&(this.isLoading.set(!0),this.authService.login(this.loginForm.value).subscribe({next:e=>{console.log("Login successful",e),e.password_change_required?(this.authService.setTemporaryPassword(this.loginForm.value.password),this.router.navigate(["/force-password-change"])):this.authService.getRole()==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/chat"]),this.isLoading.set(!1)},error:e=>{console.error("Login failed",e),this.loginError=e.error.detail||"An unknown error occurred.",this.isLoading.set(!1)}}))}static \u0275fac=function(t){return new(t||n)(g(J),g(E),g(D))};static \u0275cmp=x({type:n,selectors:[["app-login"]],decls:28,vars:11,consts:[[1,"container","vh-100","d-flex","justify-content-center","align-items-center"],[1,"card","shadow-sm",2,"width","22rem"],[1,"card-body"],[1,"card-title","text-center","mb-4"],[1,"loading-overlay"],["class","alert alert-danger","role","alert",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"mb-3","input-group"],[1,"input-group-text"],[3,"icon"],[1,"form-floating"],["type","text","id","username","formControlName","username","placeholder","Username",1,"form-control",3,"disabled"],["for","username"],["class","text-danger mb-3",4,"ngIf"],["type","password","id","password","formControlName","password","placeholder","Password",1,"form-control",3,"disabled"],["for","password"],[1,"d-grid"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"loading-content"],["role","status",1,"spinner-border","text-primary","mb-3"],[1,"visually-hidden"],[1,"loading-text"],[1,"progress"],["role","progressbar",1,"progress-bar","progress-bar-striped","progress-bar-animated",2,"width","100%"],["role","alert",1,"alert","alert-danger"],[1,"text-danger","mb-3"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(t,i){if(t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4,"Login"),s(),v(5,vt,9,0,"div",4),T(6,_t,2,1,"div",5),a(7,"form",6),F("ngSubmit",function(){return i.onSubmit()}),a(8,"div",7)(9,"span",8),p(10,"fa-icon",9),s(),a(11,"div",10),p(12,"input",11),a(13,"label",12),r(14,"Username"),s()()(),T(15,wt,2,0,"div",13),a(16,"div",7)(17,"span",8),p(18,"fa-icon",9),s(),a(19,"div",10),p(20,"input",14),a(21,"label",15),r(22,"Password"),s()()(),T(23,Ct,2,0,"div",13),a(24,"div",16)(25,"button",17),v(26,Pt,2,0)(27,xt,1,0),s()()()()()()),t&2){let o,l;c(5),_(i.isLoading()?5:-1),c(),f("ngIf",i.loginError),c(),f("formGroup",i.loginForm),c(3),f("icon",i.faUser),c(2),f("disabled",i.isLoading()),c(3),f("ngIf",((o=i.loginForm.get("username"))==null?null:o.invalid)&&((o=i.loginForm.get("username"))==null?null:o.touched)),c(3),f("icon",i.faLock),c(2),f("disabled",i.isLoading()),c(3),f("ngIf",((l=i.loginForm.get("password"))==null?null:l.invalid)&&((l=i.loginForm.get("password"))==null?null:l.touched)),c(2),f("disabled",i.loginForm.invalid||i.isLoading()),c(),_(i.isLoading()?26:27)}},dependencies:[ee,Q,H,K,$,Z,X,y,me,nt,tt,Y],styles:[".container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#1a1a1a,#2d2d2d);padding:1rem}@media (max-width: 576px){.container[_ngcontent-%COMP%]{padding:.5rem}}.card[_ngcontent-%COMP%]{background-color:#2d2d2d;border:1px solid #3d3d3d;border-radius:16px;box-shadow:0 8px 32px #0006;max-width:100%;width:22rem;position:relative}@media (max-width: 576px){.card[_ngcontent-%COMP%]{width:100%;border-radius:12px}}.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:2rem;position:relative}@media (max-width: 576px){.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1.5rem}}.card-title[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:1.75rem;margin-bottom:1.5rem}@media (max-width: 576px){.card-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:1.25rem}}.alert[_ngcontent-%COMP%]{border-radius:8px;border:none;font-size:.9rem;padding:.75rem 1rem}.alert.alert-danger[_ngcontent-%COMP%]{background-color:#dc354533;color:#ff6b7a;border-left:3px solid #dc3545}.input-group[_ngcontent-%COMP%]{margin-bottom:1rem;border-radius:12px;overflow:hidden;background-color:#1a1a1a;border:1px solid #3d3d3d;transition:all .2s ease}.input-group[_ngcontent-%COMP%]:focus-within{border-color:#0084ff;box-shadow:0 0 0 .2rem #0084ff40}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background-color:transparent;border:none;color:#888;padding:.75rem 1rem}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]   fa-icon[_ngcontent-%COMP%]{font-size:1.1rem}.input-group[_ngcontent-%COMP%]   .form-floating[_ngcontent-%COMP%]{flex:1}.input-group[_ngcontent-%COMP%]   .form-floating[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background-color:transparent;border:none;color:#fff;padding:1rem 1rem 1rem 0;height:calc(3rem + 2px)}.input-group[_ngcontent-%COMP%]   .form-floating[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{background-color:transparent;box-shadow:none}.input-group[_ngcontent-%COMP%]   .form-floating[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:transparent}.input-group[_ngcontent-%COMP%]   .form-floating[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#888;padding:1rem 1rem 1rem 0;font-size:.9rem;transition:all .2s ease}.input-group[_ngcontent-%COMP%]   .form-floating[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus ~ label[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   .form-floating[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:not(:placeholder-shown) ~ label[_ngcontent-%COMP%]{transform:scale(.85) translateY(-.75rem) translate(0);color:#0084ff}.text-danger[_ngcontent-%COMP%]{color:#ff6b7a!important;font-size:.85rem;margin-top:-.5rem;margin-bottom:1rem;padding-left:.5rem}.btn[_ngcontent-%COMP%]{font-weight:600;padding:.75rem;font-size:1rem;border-radius:12px;transition:all .2s ease;border:none}.btn.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0084ff,#06c);box-shadow:0 4px 12px #0084ff4d}.btn.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#06c,#0052a3);box-shadow:0 6px 20px #0084ff66;transform:translateY(-2px)}.btn.btn-primary[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.btn.btn-primary[_ngcontent-%COMP%]:disabled{background:linear-gradient(135deg,#4a4a4a,#3a3a3a);box-shadow:none;cursor:not-allowed;opacity:.6}.d-grid[_ngcontent-%COMP%]{margin-top:1.5rem}@media (max-width: 576px){.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{font-size:16px}.btn[_ngcontent-%COMP%]{padding:1rem;font-size:1.05rem}}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#2d2d2df2;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);border-radius:16px;display:flex;align-items:center;justify-content:center;z-index:10;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}@media (max-width: 576px){.loading-overlay[_ngcontent-%COMP%]{border-radius:12px}}.loading-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;padding:2rem;text-align:center}.loading-text[_ngcontent-%COMP%]{color:#fff;font-weight:500;font-size:1rem;margin:0}.progress[_ngcontent-%COMP%]{width:200px;height:8px;background-color:#0000004d;border-radius:4px;overflow:hidden;margin-top:.5rem}@media (max-width: 576px){.progress[_ngcontent-%COMP%]{width:150px}}.progress-bar[_ngcontent-%COMP%]{background:linear-gradient(90deg,#0084ff,#06c,#0084ff);background-size:200% 100%;animation:_ngcontent-%COMP%_progressAnimation 1.5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_progressAnimation{0%{background-position:200% 0}to{background-position:-200% 0}}@keyframes _ngcontent-%COMP%_spinner{to{transform:rotate(360deg)}}.form-control[_ngcontent-%COMP%]:disabled{background-color:#0003;color:#888;cursor:not-allowed}"]})};var Ot=["messageList"],St=["messageInput"],yt=(n,e)=>e.timestamp;function Et(n,e){if(n&1&&(a(0,"div",19)(1,"div",20)(2,"p",21),r(3),s(),a(4,"span",22),r(5),qe(6,"date"),s()()()),n&2){let t=e.$implicit,i=u();Be("sent",t.sender===i.currentUsername)("received",t.sender!==i.currentUsername),c(3),N(t.text),c(2),N(Ge(6,6,t.timestamp,"shortTime"))}}function It(n,e){n&1&&(a(0,"div",13),r(1," Admin is typing "),a(2,"span",23),p(3,"span")(4,"span")(5,"span"),s()())}function kt(n,e){n&1&&p(0,"span",18)}function Tt(n,e){n&1&&r(0," Send ")}var fe=class n{constructor(e,t,i,o,l){this.authService=e;this.router=t;this.chatService=i;this.fb=o;this.notificationService=l;this.messageForm=this.fb.group({message:["",I.required]})}messageListContainer;messageInput;messages=[];messageForm;messageSubscription;typingSubscription;currentUsername=null;isTyping=!1;isSending=!1;typingTimeout;ngOnInit(){this.notificationService.requestPermission(),this.currentUsername=this.authService.getUsername(),this.chatService.getChatHistory().subscribe(e=>{this.messages=e,this.scrollToBottom()}),this.chatService.connect(),this.messageSubscription=this.chatService.getMessages().subscribe(e=>{this.messages.push(e),this.scrollToBottom(),e.sender!==this.currentUsername&&(document.hidden,this.notificationService.showNotification("New Message",{body:e.text,icon:"assets/icons/icon-192x192.png"}))}),this.typingSubscription=this.chatService.getTypingIndicator().subscribe(e=>{this.isTyping=e,e&&this.scrollToBottom()})}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){try{this.messageListContainer.nativeElement.scrollTop=this.messageListContainer.nativeElement.scrollHeight}catch{}}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.typingSubscription&&this.typingSubscription.unsubscribe(),this.typingTimeout&&clearTimeout(this.typingTimeout),this.chatService.disconnect()}onTyping(){this.typingTimeout&&clearTimeout(this.typingTimeout),this.chatService.sendTypingIndicator(!0),this.typingTimeout=setTimeout(()=>{this.chatService.sendTypingIndicator(!1)},1e3)}sendMessage(){if(this.messageForm.valid&&!this.isSending){this.isSending=!0;let t={text:this.messageForm.value.message};this.typingTimeout&&clearTimeout(this.typingTimeout),this.chatService.sendTypingIndicator(!1),this.chatService.sendMessage(t),this.messageForm.reset(),setTimeout(()=>{this.isSending=!1,this.scrollToBottom()},300)}}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(t){return new(t||n)(g(E),g(D),g(at),g(J),g(ge))};static \u0275cmp=x({type:n,selectors:[["app-chat"]],viewQuery:function(t,i){if(t&1&&(Oe(Ot,5),Oe(St,5)),t&2){let o;Se(o=ye())&&(i.messageListContainer=o.first),Se(o=ye())&&(i.messageInput=o.first)}},decls:26,vars:4,consts:[["messageList",""],["messageInput",""],[1,"page-container"],[1,"header"],[1,"header-actions"],["routerLink","/menu",1,"btn","btn-outline-light"],[1,"bi","bi-card-list"],[1,"ms-1"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-box-arrow-right"],[1,"chat-container"],[1,"message-list"],[1,"message",3,"sent","received"],[1,"typing-indicator"],[1,"message-form",3,"ngSubmit","formGroup"],[1,"input-group"],["type","text","formControlName","message","placeholder","Type a message...",1,"form-control",3,"input"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"message"],[1,"message-bubble"],[1,"message-text"],[1,"message-timestamp"],[1,"dots"]],template:function(t,i){if(t&1){let o=oe();a(0,"div",2)(1,"div",3)(2,"h1"),r(3,"SecureChat"),s(),a(4,"div",4)(5,"a",5),p(6,"i",6),a(7,"span",7),r(8,"Menu"),s()(),a(9,"button",8),F("click",function(){return w(o),C(i.logout())}),p(10,"i",9),a(11,"span",7),r(12,"Logout"),s()()()(),a(13,"div",10)(14,"div",11,0),G(16,Et,7,9,"div",12,yt),v(18,It,6,0,"div",13),s(),a(19,"form",14),F("ngSubmit",function(){return w(o),C(i.sendMessage())}),a(20,"div",15)(21,"input",16,1),F("input",function(){return w(o),C(i.onTyping())}),s(),a(23,"button",17),v(24,kt,1,0,"span",18)(25,Tt,1,0),s()()()()()}t&2&&(c(16),W(i.messages),c(2),_(i.isTyping?18:-1),c(),f("formGroup",i.messageForm),c(4),f("disabled",i.messageForm.invalid||i.isSending),c(),_(i.isSending?24:25))},dependencies:[y,Y,pe,ee,Q,H,K,$,Z,X,He],styles:[".page-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;padding:0;background-color:#1a1a1a}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-shrink:0;padding:1rem;background-color:#2d2d2d;box-shadow:0 2px 4px #0000004d;position:sticky;top:0;z-index:100}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.25rem;margin:0;color:#fff}@media (max-width: 576px){.header[_ngcontent-%COMP%]{padding:.75rem 1rem}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.1rem}.header[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.875rem}}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}@media (max-width: 576px){.header-actions[_ngcontent-%COMP%]{gap:.375rem}.header-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:0!important}.header-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}}.chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}.message-list[_ngcontent-%COMP%]{flex-grow:1;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding:1rem;background-color:#1a1a1a;scroll-behavior:smooth}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#444;border-radius:3px}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.message[_ngcontent-%COMP%]{display:flex;width:100%;animation:_ngcontent-%COMP%_messageSlideIn .2s ease-out}@keyframes _ngcontent-%COMP%_messageSlideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.message-bubble[_ngcontent-%COMP%]{padding:12px 16px;border-radius:18px;max-width:85%;display:flex;flex-direction:column;word-wrap:break-word;position:relative}@media (min-width: 768px){.message-bubble[_ngcontent-%COMP%]{max-width:70%}}.message.sent[_ngcontent-%COMP%]{justify-content:flex-end}.message.sent[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0084ff,#06c);color:#fff;border-bottom-right-radius:4px;box-shadow:0 2px 8px #0084ff4d}.message.received[_ngcontent-%COMP%]{justify-content:flex-start}.message.received[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:#2d2d2d;color:#fff;border-bottom-left-radius:4px;box-shadow:0 2px 8px #0000004d}.message-text[_ngcontent-%COMP%]{margin:0;overflow-wrap:break-word;word-break:break-word;line-height:1.4;font-size:.95rem}.message-timestamp[_ngcontent-%COMP%]{font-size:.7rem;margin-top:4px;align-self:flex-end;opacity:.8}.message.sent[_ngcontent-%COMP%]   .message-timestamp[_ngcontent-%COMP%]{color:#fffc}.message.received[_ngcontent-%COMP%]   .message-timestamp[_ngcontent-%COMP%]{color:#fff9}.message-form[_ngcontent-%COMP%]{padding:1rem;background-color:#2d2d2d;border-top:1px solid #3d3d3d;position:sticky;bottom:0}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{gap:.5rem}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background-color:#1a1a1a;border:1px solid #3d3d3d;color:#fff;border-radius:24px;padding:.75rem 1rem;font-size:.95rem}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{background-color:#1a1a1a;border-color:#0084ff;color:#fff;box-shadow:0 0 0 .2rem #0084ff40}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:#888}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:24px;padding:.75rem 1.5rem;font-weight:600;min-width:80px}@media (max-width: 576px){.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.75rem 1rem;min-width:70px}}.message-form[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.5}.typing-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.5rem 1rem;color:#888;font-size:.85rem;font-style:italic}.typing-indicator[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]{display:inline-flex;gap:4px;margin-left:4px}.typing-indicator[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:4px;height:4px;background-color:#888;border-radius:50%;animation:_ngcontent-%COMP%_typingDot 1.4s infinite ease-in-out}.typing-indicator[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){animation-delay:-.32s}.typing-indicator[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.16s}@keyframes _ngcontent-%COMP%_typingDot{0%,80%,to{transform:scale(0);opacity:.5}40%{transform:scale(1);opacity:1}}"]})};var Ft=(n,e)=>e.id;function Nt(n,e){n&1&&(a(0,"div",7)(1,"div",9)(2,"span",10),r(3,"Loading..."),s()(),a(4,"p",11),r(5,"Loading menu..."),s()())}function Dt(n,e){if(n&1&&(a(0,"div",8),p(1,"i",12),r(2),s()),n&2){let t=u();c(2),z(" ",t.error()," ")}}function Lt(n,e){n&1&&(a(0,"div",13),p(1,"i",15),a(2,"p"),r(3,"No products available at the moment"),s()())}function At(n,e){if(n&1&&(a(0,"div",16)(1,"div",17),p(2,"i",18),s(),a(3,"div",19)(4,"h3",20),r(5),s(),a(6,"p",21),r(7),s()()()),n&2){let t=e.$implicit,i=u(3);c(5),N(t.name),c(2),z("",i.formatPrice(t.price)," DKK")}}function Rt(n,e){if(n&1&&(a(0,"div",14),G(1,At,8,2,"div",16,Ft),s()),n&2){let t=u(2);c(),W(t.products())}}function Vt(n,e){if(n&1&&v(0,Lt,4,0,"div",13)(1,Rt,3,0,"div",14),n&2){let t=u();_(t.products().length===0?0:1)}}var he=class n{constructor(e){this.menuService=e}products=b([]);loading=b(!0);error=b(null);ngOnInit(){this.loadProducts()}loadProducts(){this.loading.set(!0),this.error.set(null),this.menuService.getAllProducts().subscribe({next:e=>{this.products.set(e),this.loading.set(!1)},error:e=>{console.error("Error loading menu:",e),this.error.set("Failed to load menu. Please try again later."),this.loading.set(!1)}})}formatPrice(e){return e.toFixed(2)}static \u0275fac=function(t){return new(t||n)(g(st))};static \u0275cmp=x({type:n,selectors:[["app-menu"]],decls:14,vars:3,consts:[[1,"menu-container"],[1,"menu-header"],[1,"menu-title"],[1,"bi","bi-card-list"],[1,"menu-subtitle"],["routerLink","/chat",1,"btn","btn-outline-primary"],[1,"bi","bi-arrow-left","me-2"],[1,"loading-container"],["role","alert",1,"alert","alert-danger"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"loading-text"],[1,"bi","bi-exclamation-triangle","me-2"],[1,"empty-state"],[1,"products-grid"],[1,"bi","bi-inbox"],[1,"product-card"],[1,"product-icon"],[1,"bi","bi-bag-fill"],[1,"product-info"],[1,"product-name"],[1,"product-price"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),p(4,"i",3),r(5," Menu "),s(),a(6,"p",4),r(7,"Browse our available products"),s()(),a(8,"a",5),p(9,"i",6),r(10," Back to Chat "),s()(),v(11,Nt,6,0,"div",7),v(12,Dt,3,1,"div",8),v(13,Vt,2,1),s()),t&2&&(c(11),_(i.loading()?11:-1),c(),_(i.error()?12:-1),c(),_(!i.loading()&&!i.error()?13:-1))},dependencies:[y,pe],styles:[".menu-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#1a1a1a;padding:1.5rem}@media (max-width: 576px){.menu-container[_ngcontent-%COMP%]{padding:1rem}}.menu-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}@media (max-width: 576px){.menu-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}.menu-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#fff;margin-bottom:.5rem;display:flex;align-items:center;gap:.75rem}.menu-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#0084ff}@media (max-width: 576px){.menu-title[_ngcontent-%COMP%]{font-size:1.5rem}}.menu-subtitle[_ngcontent-%COMP%]{color:#aaa;font-size:.95rem;margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 0;gap:1rem}.loading-text[_ngcontent-%COMP%]{color:#aaa;font-size:.95rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:#555;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#aaa;font-size:1.1rem;margin:0}.products-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.5rem}@media (max-width: 576px){.products-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}}.product-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2d2d2d,#1a1a1a);border:1px solid #3d3d3d;border-radius:16px;padding:1.5rem;display:flex;gap:1rem;transition:all .3s ease;cursor:default}.product-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 8px 24px #0084ff33;border-color:#0084ff}@media (max-width: 576px){.product-card[_ngcontent-%COMP%]{padding:1.25rem}}.product-icon[_ngcontent-%COMP%]{width:64px;height:64px;background:linear-gradient(135deg,#0084ff,#06c);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.product-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:#fff}@media (max-width: 576px){.product-icon[_ngcontent-%COMP%]{width:56px;height:56px}.product-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.75rem}}.product-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center}.product-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#fff;margin-bottom:.5rem;margin:0 0 .5rem}@media (max-width: 576px){.product-name[_ngcontent-%COMP%]{font-size:1.1rem}}.product-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#0084ff;margin:0}@media (max-width: 576px){.product-price[_ngcontent-%COMP%]{font-size:1.25rem}}"]})};var ae=(n,e)=>{let t=O(E),i=O(D);return t.isAuthenticated()?!0:(i.navigate(["/login"]),!1)};function jt(n,e){if(n&1&&(a(0,"div",15),r(1),s()),n&2){let t=u();c(),z(" ",t.changePasswordError," ")}}function zt(n,e){n&1&&(a(0,"div",16),r(1,"New password is required and must be at least 8 characters."),s())}function Ut(n,e){n&1&&(a(0,"div",16),r(1,"Passwords do not match."),s())}var be=class n{constructor(e,t,i){this.fb=e;this.authService=t;this.router=i;this.changePasswordForm=this.fb.group({newPassword:["",[I.required,I.minLength(8)]],confirmPassword:["",I.required]},{validator:this.passwordMatchValidator})}changePasswordForm;changePasswordError=null;oldPassword=null;ngOnInit(){this.oldPassword=this.authService.getTemporaryPassword(),this.oldPassword||this.router.navigate(["/login"])}passwordMatchValidator(e){return e.get("newPassword")?.value===e.get("confirmPassword")?.value?null:{mismatch:!0}}onSubmit(){if(this.changePasswordError=null,this.changePasswordForm.valid&&this.oldPassword){let{newPassword:e}=this.changePasswordForm.value;this.authService.changePassword(this.oldPassword,e).subscribe({next:()=>{console.log("Password changed successfully");let t=this.authService.getUsername();t?this.authService.login({username:t,password:e}).subscribe({next:()=>{this.authService.getRole()==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/chat"])},error:i=>{console.error("Login after password change failed",i),this.changePasswordError="Login failed after password change. Please login again."}}):this.router.navigate(["/login"])},error:t=>{console.error("Password change failed",t),this.changePasswordError=t.error.detail||"An unknown error occurred."}})}}static \u0275fac=function(t){return new(t||n)(g(J),g(E),g(D))};static \u0275cmp=x({type:n,selectors:[["app-force-password-change"]],decls:22,vars:5,consts:[[1,"container","vh-100","d-flex","justify-content-center","align-items-center"],[1,"card","shadow-sm",2,"width","22rem"],[1,"card-body"],[1,"card-title","text-center","mb-4"],[1,"text-muted","text-center"],["class","alert alert-danger","role","alert",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","newPassword",1,"form-label"],["type","password","id","newPassword","formControlName","newPassword",1,"form-control"],["class","text-danger mb-3",4,"ngIf"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword",1,"form-control"],[1,"d-grid"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","alert",1,"alert","alert-danger"],[1,"text-danger","mb-3"]],template:function(t,i){if(t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4,"Change Password"),s(),a(5,"p",4),r(6,"You must change your password before you can proceed."),s(),T(7,jt,2,1,"div",5),a(8,"form",6),F("ngSubmit",function(){return i.onSubmit()}),a(9,"div",7)(10,"label",8),r(11,"New Password"),s(),p(12,"input",9),s(),T(13,zt,2,0,"div",10),a(14,"div",7)(15,"label",11),r(16,"Confirm New Password"),s(),p(17,"input",12),s(),T(18,Ut,2,0,"div",10),a(19,"div",13)(20,"button",14),r(21,"Change Password"),s()()()()()()),t&2){let o,l;c(7),f("ngIf",i.changePasswordError),c(),f("formGroup",i.changePasswordForm),c(5),f("ngIf",((o=i.changePasswordForm.get("newPassword"))==null?null:o.invalid)&&((o=i.changePasswordForm.get("newPassword"))==null?null:o.touched)),c(5),f("ngIf",i.changePasswordForm.hasError("mismatch")&&((l=i.changePasswordForm.get("confirmPassword"))==null?null:l.touched)),c(2),f("disabled",i.changePasswordForm.invalid)}},dependencies:[ee,Q,H,K,$,Z,X,y,me,Y],encapsulation:2})};var pt=[{path:"login",component:ue},{path:"force-password-change",component:be,canActivate:[ae]},{path:"chat",component:fe,canActivate:[ae]},{path:"menu",component:he,canActivate:[ae]},{path:"admin",loadChildren:()=>import("./chunk-CFMTIRSM.js").then(n=>n.AdminModule),canActivate:[ae]},{path:"",redirectTo:"login",pathMatch:"full"}];var Ee="Service workers are disabled or not supported by this browser",te=class{serviceWorker;worker;registration;events;constructor(e,t){if(this.serviceWorker=e,!e)this.worker=this.events=this.registration=new le(i=>i.error(new V(5601,!1)));else{let i=null,o=new U;this.worker=new le(M=>(i!==null&&M.next(i),o.subscribe(ce=>M.next(ce))));let l=()=>{let{controller:M}=e;M!==null&&(i=M,o.next(i))};e.addEventListener("controllerchange",l),l(),this.registration=this.worker.pipe(ie(()=>e.getRegistration().then(M=>{if(!M)throw new V(5601,!1);return M})));let h=new U;this.events=h.asObservable();let A=M=>{let{data:ce}=M;ce?.type&&h.next(ce)};e.addEventListener("message",A),t?.get(Me,null,{optional:!0})?.onDestroy(()=>{e.removeEventListener("controllerchange",l),e.removeEventListener("message",A)})}}postMessage(e,t){return new Promise(i=>{this.worker.pipe(B(1)).subscribe(o=>{o.postMessage(ke({action:e},t)),i()})})}postMessageWithOperation(e,t,i){let o=this.waitForOperationCompleted(i),l=this.postMessage(e,t);return Promise.all([l,o]).then(([,h])=>h)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(e){let t;return typeof e=="string"?t=i=>i.type===e:t=i=>e.includes(i.type),this.events.pipe(xe(t))}nextEventOfType(e){return this.eventsOfType(e).pipe(B(1))}waitForOperationCompleted(e){return new Promise((t,i)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(xe(o=>o.nonce===e),B(1),R(o=>{if(o.result!==void 0)return o.result;throw new Error(o.error)})).subscribe({next:t,error:i})})}get isEnabled(){return!!this.serviceWorker}},Ie=(()=>{class n{sw;messages;notificationClicks;notificationCloses;pushSubscriptionChanges;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new U;constructor(t){if(this.sw=t,!t.isEnabled){this.messages=k,this.notificationClicks=k,this.notificationCloses=k,this.pushSubscriptionChanges=k,this.subscription=k;return}this.messages=this.sw.eventsOfType("PUSH").pipe(R(o=>o.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(R(o=>o.data)),this.notificationCloses=this.sw.eventsOfType("NOTIFICATION_CLOSE").pipe(R(o=>o.data)),this.pushSubscriptionChanges=this.sw.eventsOfType("PUSH_SUBSCRIPTION_CHANGE").pipe(R(o=>o.data)),this.pushManager=this.sw.registration.pipe(R(o=>o.pushManager));let i=this.pushManager.pipe(ie(o=>o.getSubscription()));this.subscription=new le(o=>{let l=i.subscribe(o),h=this.subscriptionChanges.subscribe(o);return()=>{l.unsubscribe(),h.unsubscribe()}})}requestSubscription(t){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(Ee));let i={userVisibleOnly:!0},o=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),l=new Uint8Array(new ArrayBuffer(o.length));for(let h=0;h<o.length;h++)l[h]=o.charCodeAt(h);return i.applicationServerKey=l,new Promise((h,A)=>{this.pushManager.pipe(ie(ne=>ne.subscribe(i)),B(1)).subscribe({next:ne=>{this.subscriptionChanges.next(ne),h(ne)},error:A})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(Ee));let t=i=>{if(i===null)throw new V(5602,!1);return i.unsubscribe().then(o=>{if(!o)throw new V(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((i,o)=>{this.subscription.pipe(B(1),ie(t)).subscribe({next:i,error:o})})}decodeBase64(t){return atob(t)}static \u0275fac=function(i){return new(i||n)(q(te))};static \u0275prov=j({token:n,factory:n.\u0275fac})}return n})(),Bt=(()=>{class n{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(t){if(this.sw=t,!t.isEnabled){this.versionUpdates=k,this.unrecoverable=k;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED","VERSION_FAILED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Ee));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let t=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:t},t).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new V(5601,!1));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:t},t)}static \u0275fac=function(i){return new(i||n)(q(te))};static \u0275prov=j({token:n,factory:n.\u0275fac})}return n})();var ut=new Fe("");function qt(){let n=O(se);if(!("serviceWorker"in navigator&&n.enabled!==!1))return;let e=O(ut),t=O(Ve),i=O(Me);t.runOutsideAngular(()=>{let o=navigator.serviceWorker,l=()=>o.controller?.postMessage({action:"INITIALIZE"});o.addEventListener("controllerchange",l),i.onDestroy(()=>{o.removeEventListener("controllerchange",l)})}),t.runOutsideAngular(()=>{let o,{registrationStrategy:l}=n;if(typeof l=="function")o=new Promise(h=>l().subscribe(()=>h()));else{let[h,...A]=(l||"registerWhenStable:30000").split(":");switch(h){case"registerImmediately":o=Promise.resolve();break;case"registerWithDelay":o=gt(+A[0]||0);break;case"registerWhenStable":o=Promise.race([i.whenStable(),gt(+A[0])]);break;default:throw new V(5600,!1)}}o.then(()=>{i.destroyed||navigator.serviceWorker.register(e,{scope:n.scope,updateViaCache:n.updateViaCache,type:n.type}).catch(h=>console.error(Te(5604,!1)))})})}function gt(n){return new Promise(e=>setTimeout(e,n))}function Gt(n,e){return new te(n.enabled!==!1?navigator.serviceWorker:void 0,e)}var se=class{enabled;updateViaCache;type;scope;registrationStrategy};function ft(n,e={}){return Ne([Ie,Bt,{provide:ut,useValue:n},{provide:se,useValue:e},{provide:te,useFactory:Gt,deps:[se,Ae]},je(qt)])}var ht=(n,e)=>{let i=O(E).getToken();if(i){let o=n.clone({setHeaders:{Authorization:`Bearer ${i}`}});return e(o)}return e(n)};var bt={providers:[Xe,Qe(Ze([ht])),Re(),We({eventCoalescing:!0}),et(pt),ft("ngsw-worker.js",{enabled:!Ye(),registrationStrategy:"registerWhenStable:30000"})]};var ve=class n{deferredPrompt=null;installPromptShown=b(!1);canInstall=b(!1);isInstalled=b(!1);isStandalone=b(!1);installSubject=new U;constructor(){this.checkIfInstalled(),this.listenForInstallPrompt()}checkIfInstalled(){let e=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");this.isStandalone.set(e),this.isInstalled.set(e)}listenForInstallPrompt(){Pe(window,"beforeinstallprompt").subscribe(e=>{e.preventDefault(),this.deferredPrompt=e,this.canInstall.set(!0),setTimeout(()=>{!this.installPromptShown()&&!this.isInstalled()&&this.installSubject.next()},5e3)}),Pe(window,"appinstalled").subscribe(()=>{this.isInstalled.set(!0),this.canInstall.set(!1),this.deferredPrompt=null})}promptInstall(){return de(this,null,function*(){if(!this.deferredPrompt)return!1;yield this.deferredPrompt.prompt();let{outcome:e}=yield this.deferredPrompt.userChoice;return this.deferredPrompt=null,this.canInstall.set(!1),e==="accepted"})}getInstallPromptObservable(){return this.installSubject.asObservable()}dismissInstallPrompt(){this.installPromptShown.set(!0),localStorage.setItem("pwa-install-dismissed",Date.now().toString())}shouldShowInstallPrompt(){if(this.isInstalled()||!this.canInstall())return!1;let e=localStorage.getItem("pwa-install-dismissed");if(e){let t=parseInt(e,10);return(Date.now()-t)/(1e3*60*60*24)>7}return!0}getInstallInstructions(){let e=window.navigator.userAgent.toLowerCase(),t=/iphone|ipad|ipod/.test(e),i=/safari/.test(e)&&!/chrome/.test(e);return t||i?{platform:"iOS/Safari",instructions:["Tap the Share button (square with arrow)",'Scroll down and tap "Add to Home Screen"','Tap "Add" in the top right corner',"You'll find SecureChat on your home screen!"]}:{platform:"Android/Chrome",instructions:["Tap the menu button (three dots)",'Tap "Add to Home Screen" or "Install app"','Tap "Install" or "Add"',"You'll find SecureChat on your home screen!"]}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};function Ht(n,e){n&1&&(P(0,"span",19),r(1," Installing... "))}function Kt(n,e){n&1&&(P(0,"i",20),r(1," Install Now "))}function $t(n,e){if(n&1){let t=oe();d(0,"div",1),S("click",function(){w(t);let o=u();return C(o.onDismiss())}),d(1,"div",2),S("click",function(o){return w(t),C(o.stopPropagation())}),d(2,"div",3),De(),d(3,"svg",4),P(4,"path",5)(5,"path",6),m()(),Le(),d(6,"h3",7),r(7,"Install SecureChat"),m(),d(8,"p",8),r(9,"Install SecureChat on your device for quick access, offline support, and push notifications!"),m(),d(10,"div",9)(11,"div",10),P(12,"i",11),d(13,"span"),r(14,"Instant access"),m()(),d(15,"div",10),P(16,"i",12),d(17,"span"),r(18,"Works offline"),m()(),d(19,"div",10),P(20,"i",13),d(21,"span"),r(22,"Push notifications"),m()()(),d(23,"div",14)(24,"button",15),S("click",function(){w(t);let o=u();return C(o.onDismiss())}),r(25,"Maybe Later"),m(),d(26,"button",16),S("click",function(){w(t);let o=u();return C(o.onInstall())}),v(27,Ht,2,0)(28,Kt,2,0),m()(),d(29,"button",17),S("click",function(){w(t);let o=u();return C(o.showManualInstructions())}),P(30,"i",18),r(31," Need help installing? "),m()()()}if(n&2){let t=u();c(26),Ue("disabled",t.installing()),c(),_(t.installing()?27:28)}}function Qt(n,e){if(n&1&&(d(0,"li"),r(1),m()),n&2){let t=e.$implicit;c(),N(t)}}function Zt(n,e){n&1&&(d(0,"div",30)(1,"div",33),P(2,"i",34),m(),d(3,"div",35),P(4,"i",36),m(),d(5,"div",37),r(6,"Add to Home Screen"),m()())}function Xt(n,e){n&1&&(d(0,"div",31)(1,"div",38),P(2,"i",39),m(),d(3,"div",35),P(4,"i",36),m(),d(5,"div",40),r(6,"Install app"),m()())}function Jt(n,e){if(n&1){let t=oe();d(0,"div",1),S("click",function(){w(t);let o=u();return C(o.closeInstructions())}),d(1,"div",21),S("click",function(o){return w(t),C(o.stopPropagation())}),d(2,"button",22),S("click",function(){w(t);let o=u();return C(o.closeInstructions())}),P(3,"i",23),m(),d(4,"div",24),P(5,"i",25),m(),d(6,"h3",26),r(7,"Install SecureChat"),m(),d(8,"p",27),r(9),m(),d(10,"ol",28),G(11,Qt,2,1,"li",null,ze),m(),d(13,"div",29),v(14,Zt,7,0,"div",30)(15,Xt,7,0,"div",31),m(),d(16,"button",32),S("click",function(){w(t);let o=u();return C(o.closeInstructions())}),r(17,"Got it!"),m()()()}if(n&2){let t=u();c(9),N(t.instructions.platform),c(2),W(t.instructions.instructions),c(3),_(t.instructions.platform==="iOS/Safari"?14:15)}}var _e=class n{constructor(e,t){this.pwaInstallService=e;this.notificationService=t}showPrompt=b(!1);showInstructions=b(!1);installing=b(!1);instructions=null;installSubscription;ngOnInit(){this.installSubscription=this.pwaInstallService.getInstallPromptObservable().subscribe(()=>{this.pwaInstallService.shouldShowInstallPrompt()&&this.showPrompt.set(!0)}),this.pwaInstallService.canInstall()&&this.pwaInstallService.shouldShowInstallPrompt()&&setTimeout(()=>{this.showPrompt.set(!0)},5e3)}ngOnDestroy(){this.installSubscription?.unsubscribe()}onInstall(){return de(this,null,function*(){this.installing.set(!0),(yield this.pwaInstallService.promptInstall())?(this.showPrompt.set(!1),setTimeout(()=>{this.requestNotifications()},1e3)):(this.instructions=this.pwaInstallService.getInstallInstructions(),this.showInstructions.set(!0)),this.installing.set(!1)})}onDismiss(){this.pwaInstallService.dismissInstallPrompt(),this.showPrompt.set(!1)}showManualInstructions(){this.instructions=this.pwaInstallService.getInstallInstructions(),this.showInstructions.set(!0)}closeInstructions(){this.showInstructions.set(!1),this.showPrompt.set(!1),this.pwaInstallService.dismissInstallPrompt()}requestNotifications(){"Notification"in window&&Notification.permission==="default"&&this.notificationService.requestPermission()}static \u0275fac=function(t){return new(t||n)(g(ve),g(ge))};static \u0275cmp=x({type:n,selectors:[["app-pwa-install-prompt"]],decls:2,vars:2,consts:[[1,"pwa-prompt-overlay"],[1,"pwa-prompt-overlay",3,"click"],[1,"pwa-prompt-card",3,"click"],[1,"pwa-prompt-icon"],["width","64","height","64","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M12 2L2 7V12C2 16.97 5.5 21.47 10 22.5V20.45C6.55 19.5 4 16.42 4 12V8.3L12 4.19L20 8.3V12C20 16.42 17.45 19.5 14 20.45V22.5C18.5 21.47 22 16.97 22 12V7L12 2Z","fill","currentColor"],["d","M12 6L6 9V14C6 17.31 8.69 20.16 12 20.87C15.31 20.16 18 17.31 18 14V9L12 6Z","fill","currentColor","opacity","0.5"],[1,"pwa-prompt-title"],[1,"pwa-prompt-description"],[1,"pwa-prompt-features"],[1,"feature"],[1,"bi","bi-lightning-fill"],[1,"bi","bi-wifi-off"],[1,"bi","bi-bell-fill"],[1,"pwa-prompt-actions"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],[1,"pwa-prompt-help",3,"click"],[1,"bi","bi-question-circle"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-download","me-2"],[1,"pwa-instructions-card",3,"click"],[1,"close-btn",3,"click"],[1,"bi","bi-x-lg"],[1,"instructions-icon"],[1,"bi","bi-phone"],[1,"instructions-title"],[1,"instructions-platform"],[1,"instructions-list"],[1,"instructions-visual"],[1,"ios-visual"],[1,"android-visual"],[1,"btn","btn-primary","w-100","mt-3",3,"click"],[1,"share-icon"],[1,"bi","bi-box-arrow-up"],[1,"arrow-down"],[1,"bi","bi-arrow-down"],[1,"add-to-home"],[1,"menu-icon"],[1,"bi","bi-three-dots-vertical"],[1,"install-text"]],template:function(t,i){t&1&&(v(0,$t,32,2,"div",0),v(1,Jt,18,2,"div",0)),t&2&&(_(i.showPrompt()&&!i.showInstructions()?0:-1),c(),_(i.showInstructions()&&i.instructions?1:-1))},dependencies:[y],styles:[".pwa-prompt-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#000000bf;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:9999;padding:1rem;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.pwa-prompt-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2d2d2d,#1a1a1a);border-radius:20px;padding:2rem;max-width:400px;width:100%;box-shadow:0 20px 60px #00000080;border:1px solid #3d3d3d;animation:_ngcontent-%COMP%_slideUp .3s ease-out;text-align:center}@media (max-width: 576px){.pwa-prompt-card[_ngcontent-%COMP%]{padding:1.5rem;max-width:100%;border-radius:16px}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}.pwa-prompt-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 1.5rem;background:linear-gradient(135deg,#0084ff,#06c);border-radius:20px;display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 8px 24px #0084ff66}@media (max-width: 576px){.pwa-prompt-icon[_ngcontent-%COMP%]{width:64px;height:64px;margin-bottom:1rem}.pwa-prompt-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:48px;height:48px}}.pwa-prompt-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:.75rem}@media (max-width: 576px){.pwa-prompt-title[_ngcontent-%COMP%]{font-size:1.25rem}}.pwa-prompt-description[_ngcontent-%COMP%]{color:#aaa;font-size:.95rem;line-height:1.5;margin-bottom:1.5rem}@media (max-width: 576px){.pwa-prompt-description[_ngcontent-%COMP%]{font-size:.9rem}}.pwa-prompt-features[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-bottom:2rem;gap:1rem}@media (max-width: 576px){.pwa-prompt-features[_ngcontent-%COMP%]{flex-direction:column;gap:.75rem;margin-bottom:1.5rem}}.pwa-prompt-features[_ngcontent-%COMP%]   .feature[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.5rem;color:#0084ff}@media (max-width: 576px){.pwa-prompt-features[_ngcontent-%COMP%]   .feature[_ngcontent-%COMP%]{flex-direction:row;justify-content:center}}.pwa-prompt-features[_ngcontent-%COMP%]   .feature[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}@media (max-width: 576px){.pwa-prompt-features[_ngcontent-%COMP%]   .feature[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}}.pwa-prompt-features[_ngcontent-%COMP%]   .feature[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.85rem;color:#ccc}@media (max-width: 576px){.pwa-prompt-features[_ngcontent-%COMP%]   .feature[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem}}.pwa-prompt-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-bottom:1rem}@media (max-width: 576px){.pwa-prompt-actions[_ngcontent-%COMP%]{flex-direction:column}}.pwa-prompt-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;font-weight:600;border-radius:12px;transition:all .2s ease}.pwa-prompt-actions[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0084ff,#06c);border:none;box-shadow:0 4px 12px #0084ff4d}.pwa-prompt-actions[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px #0084ff66}.pwa-prompt-actions[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.pwa-prompt-actions[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]{background-color:#3d3d3d;border:1px solid #4d4d4d;color:#ccc}.pwa-prompt-actions[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#4d4d4d;transform:translateY(-2px)}.pwa-prompt-help[_ngcontent-%COMP%]{background:none;border:none;color:#0084ff;font-size:.85rem;cursor:pointer;padding:.5rem;display:flex;align-items:center;gap:.5rem;margin:0 auto;transition:color .2s ease}.pwa-prompt-help[_ngcontent-%COMP%]:hover{color:#06c;text-decoration:underline}.pwa-prompt-help[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.pwa-instructions-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2d2d2d,#1a1a1a);border-radius:20px;padding:2rem;max-width:450px;width:100%;box-shadow:0 20px 60px #00000080;border:1px solid #3d3d3d;animation:_ngcontent-%COMP%_slideUp .3s ease-out;position:relative}@media (max-width: 576px){.pwa-instructions-card[_ngcontent-%COMP%]{padding:1.5rem;border-radius:16px}}.close-btn[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:none;border:none;color:#888;font-size:1.5rem;cursor:pointer;padding:.5rem;line-height:1;transition:color .2s ease}.close-btn[_ngcontent-%COMP%]:hover{color:#fff}.instructions-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 1.5rem;background:linear-gradient(135deg,#0084ff,#06c);border-radius:20px;display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 8px 24px #0084ff66;font-size:2.5rem}@media (max-width: 576px){.instructions-icon[_ngcontent-%COMP%]{width:64px;height:64px;margin-bottom:1rem;font-size:2rem}}.instructions-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:.5rem;text-align:center}@media (max-width: 576px){.instructions-title[_ngcontent-%COMP%]{font-size:1.25rem}}.instructions-platform[_ngcontent-%COMP%]{color:#0084ff;font-size:.9rem;font-weight:600;margin-bottom:1.5rem;text-align:center}.instructions-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1.5rem;counter-reset:step-counter}.instructions-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{counter-increment:step-counter;padding:.75rem 0 .75rem 3rem;position:relative;color:#ccc;line-height:1.6}.instructions-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:counter(step-counter);position:absolute;left:0;top:.75rem;width:32px;height:32px;background:linear-gradient(135deg,#0084ff,#06c);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem}.instructions-visual[_ngcontent-%COMP%]{background-color:#1a1a1a;border:1px solid #3d3d3d;border-radius:12px;padding:1.5rem;margin-bottom:1.5rem}.ios-visual[_ngcontent-%COMP%], .android-visual[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.ios-visual[_ngcontent-%COMP%]   .share-icon[_ngcontent-%COMP%], .ios-visual[_ngcontent-%COMP%]   .menu-icon[_ngcontent-%COMP%], .android-visual[_ngcontent-%COMP%]   .share-icon[_ngcontent-%COMP%], .android-visual[_ngcontent-%COMP%]   .menu-icon[_ngcontent-%COMP%]{width:60px;height:60px;background:linear-gradient(135deg,#0084ff,#06c);border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:2rem}.ios-visual[_ngcontent-%COMP%]   .arrow-down[_ngcontent-%COMP%], .android-visual[_ngcontent-%COMP%]   .arrow-down[_ngcontent-%COMP%]{color:#0084ff;font-size:2rem;animation:_ngcontent-%COMP%_bounce 2s infinite}.ios-visual[_ngcontent-%COMP%]   .add-to-home[_ngcontent-%COMP%], .ios-visual[_ngcontent-%COMP%]   .install-text[_ngcontent-%COMP%], .android-visual[_ngcontent-%COMP%]   .add-to-home[_ngcontent-%COMP%], .android-visual[_ngcontent-%COMP%]   .install-text[_ngcontent-%COMP%]{background-color:#2d2d2d;color:#fff;padding:.75rem 1.5rem;border-radius:8px;font-weight:600;border:1px solid #4d4d4d}@keyframes _ngcontent-%COMP%_bounce{0%,20%,50%,80%,to{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}.w-100[_ngcontent-%COMP%]{width:100%}.mt-3[_ngcontent-%COMP%]{margin-top:1rem}"]})};var we=class n{constructor(e,t){this.http=e;this.swPush=t}VAPID_PUBLIC_KEY="BF8nb-w_hSCaoPSgtE6URzzZhMgW4vBiDWFLvGQxD619X9-kFcHt5I9EgpxbTB1yUon6P_p0m2BGzyFEYv5ecfU";apiUrl=rt.apiurl;permissionRequestedKey="notification_permission_requested";init(){this.swPush.isEnabled&&(this.swPush.messages.subscribe(t=>{console.log("Push message received:",t),this.showNotification(t)}),this.swPush.notificationClicks.subscribe(({action:t,notification:i})=>{console.log("Notification clicked:",t,i),window.focus()}),localStorage.getItem(this.permissionRequestedKey)||this.requestSubscription())}requestSubscription(){this.swPush.requestSubscription({serverPublicKey:this.VAPID_PUBLIC_KEY}).then(e=>{console.log("Push subscription created:",e),this.http.post(`${this.apiUrl}subscriptions`,e).subscribe({next:()=>{console.log("Subscription saved to server"),localStorage.setItem(this.permissionRequestedKey,"true")},error:t=>{console.error("Could not save subscription to server",t)}})}).catch(e=>{console.error("Could not subscribe to notifications",e),localStorage.setItem(this.permissionRequestedKey,"true")})}showNotification(e){let t=e.title||"New Message",i={body:e.body||"You have a new message",icon:"/assets/icons/icon-192x192.png",badge:"/assets/icons/icon-72x72.png",tag:"securechat-message",requireInteraction:!1};"Notification"in window&&Notification.permission==="granted"&&(new Notification(t,i),"vibrate"in navigator&&navigator.vibrate([200,100,200]))}requestPermission(){if(!this.swPush.isEnabled){console.warn("Service Worker is not enabled");return}this.requestSubscription()}static \u0275fac=function(t){return new(t||n)(q($e),q(Ie))};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ce=class n{constructor(e){this.pushNotificationService=e}title=b("SecureChat");ngOnInit(){this.pushNotificationService.init()}static \u0275fac=function(t){return new(t||n)(g(we))};static \u0275cmp=x({type:n,selectors:[["app-root"]],decls:2,vars:0,template:function(t,i){t&1&&p(0,"router-outlet")(1,"app-pwa-install-prompt")},dependencies:[Je,_e],encapsulation:2})};Ke(Ce,bt).catch(n=>console.error(n));
